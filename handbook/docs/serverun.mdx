---
id: serverun
title: 2.0 极速上手
sidebar_label: 2.0 极速上手 ✨
---

import useBaseUrl from "@docusaurus/useBaseUrl";

:::important 版本说明

以下内容仅限 `Furion 3.6.0 +` 版本使用。

:::

:::tip 推荐使用脚手架

`Furion` 官方提供了非常灵活方便的脚手架，可以快速的创建多层架构项目。

推荐使用 《[2.2 官方脚手架](template.mdx)》代替本章节功能。

:::

## 2.0.1 历史背景

相信从 `ASP.NET 5` 使用到 `ASP.NET 6` 的开发者都经历过这样变更：

- 在 `ASP.NET 5` 中，我们这样创建 `Web 主机`：

```cs showLineNumbers title="Program.cs"
Host.CreateDefaultBuilder(args)
    .ConfigureWebHostDefaults(webBuilder =>
    {
        webBuilder.UseStartup<Startup>();
    });
```

- 在 `ASP.NET 6` 中， 我们这样创建 `Web 主机`：

```cs showLineNumbers title="Program.cs"
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();
```

试问，`ASP.NET 7` 呢？`ASP.NET 8` 呢？`ASP.NET N` 呢？会不会每一个版本都有不同的创建 `Web 主机` 方式，那后续我们的项目如何无缝升级？

**所以，`Furion` 为了保证一致的代码体验和后续无缝升级，创造出了 `Serve.Run()`，即使未来创建 `Web 主机方式变了`，也不用担心，交给 `Furion` 框架即可。**

## 2.0.2 创建 `控制台` 项目

- 打开 `Visual Studio 2022` 并创建 `控制台` 项目

<img src={useBaseUrl("img/01.png")} />

- 配置项目名称

<img src={useBaseUrl("img/02.png")} />

- 选择 `.NET6`

<img src={useBaseUrl("img/03.png")} />

:::tip 使用命令行方式

```bash showLineNumbers
// 创建控制台项目
dotnet new console -n HelloFurion
```

:::

## 2.0.3 添加 `Furion` 依赖包

<img src={useBaseUrl("img/04.png")} />

:::tip 使用命令行方式

```bash showLineNumbers
// 进入创建的目录
cd HelloFurion
// 添加包
dotnet add package Furion --version 3.6.0
```

:::

## 2.0.4 一句话搞定

修改 `Program.cs` 代码为：

```cs showLineNumbers title="Program.cs"
Serve.Run();
```

对，你没看错，`Furion` 已经配置好了！

## 2.0.5 启动浏览器

启动浏览器查看效果

<img src={useBaseUrl("img/05.png")} />

<img src={useBaseUrl("img/06.png")} />

是不是超级超级简单！！！

## 2.0.6 编写第一个 `API`

```cs showLineNumbers title="Program.cs" {3,6}
Serve.Run();

[DynamicApiController]
public class HelloService
{
    public string Say()
    {
        return "Hello, Furion";
    }
}
```

启动浏览器查看效果

<img src={useBaseUrl("img/07.png")} />

## 2.0.7 `Serve.Run()` 更多配置

### 2.0.7.1 配置默认端口

默认情况下，创建的 `Web` 主机端口为 `5000/5001` 端口，如需自定义配置，可通过第一个参数配置

```cs showLineNumbers
Serve.Run("https://localhost:8080");
```

### 2.0.7.2 完全自定义配置

以下功能相当于完全自定义，也就是除了默认集成了 `Furion` 以外，没有注册任何功能。

- 基础配置

```cs showLineNumbers {5,9}
using Microsoft.AspNetCore.Hosting;

Serve.Run(b =>
{
    b.ConfigureServices(services =>
    {
        // 注册 服务
    })
    .Configure(app =>
    {
        // 注册中间件
    });
});
```

- 更多重载配置

```cs showLineNumbers {6,16}
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.DependencyInjection;

Serve.Run(b =>
{
    b.ConfigureServices((context, services) =>
    {
        // 获取配置
        var configuration = context.Configuration;

        // 获取环境
        var environment = context.HostingEnvironment;

        // 注册服务等等
    })
    .Configure((context, app) =>
    {
        // 获取配置
        var configuration = context.Configuration;

        // 获取环境
        var environment = context.HostingEnvironment;

        // 注册其他中间件等等
    });
});
```

- 实现 `Startup` 模式

```cs showLineNumbers
Serve.Run(b => {}); // 委托写非空默认值即可
```

### 2.0.7.2 一个自定义小例子

```cs showLineNumbers {7-19}
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.DependencyInjection;

Serve.Run(b =>
{
    b.ConfigureServices(services =>
    {
        services.AddControllers().AddInject();
    })
    .Configure(app =>
    {
        app.UseRouting();
        app.UseInject(string.Empty);
        app.UseEndpoints(endpoints =>
        {
            endpoints.MapControllers();
        });
    });
});

[DynamicApiController]
public class HelloService
{
    public string Say()
    {
        return "Hello, Furion";
    }
}
```

<img src={useBaseUrl("img/07.png")} />

### 2.0.7.3 主机自定义配置

```cs showLineNumbers {10-13}
Serve.Run(b =>
{
    b.ConfigureServices(services =>
    {
    })
    .Configure(app =>
    {
    });
},
hostBuilderConfigure: h =>
{
    // h.ConfigureAppConfiguration(....
});
```

## 2.0.8 支持 `Furion` 所有功能

`Serve.Run()` 看似非常简单，实则非常灵活，而且支持 `Furion` 和 `.NET` 所有功能。

### 2.0.8.1 添加 `appsettings.json`

创建 `appsettings.json` 文件，并设置 `属性` 为 `如果较新则复制` 和 `内容`（生成操作）

```json showLineNumbers
{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information",
      "Microsoft.EntityFrameworkCore": "Information"
    }
  },
  "AllowedHosts": "*"
}
```

在代码中读取配置：

```cs showLineNumbers {10}
using Furion;

Serve.Run();

[DynamicApiController]
public class HelloService
{
    public string Say()
    {
        return "Hello, Furion " + App.Configuration["Logging:LogLevel:Default"];
    }
}
```

<img src={useBaseUrl("img/08.png")} />

### 2.0.8.2 添加自定义 `Startup`

在 `Furion` 中可以派生自 `AppStartup` 可以实现更多配置，如：

```cs showLineNumbers {8,10,12,15,17} title="MyStartup.cs"
using Furion;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.DependencyInjection;

namespace HelloFurion
{
    public class MyStartup : AppStartup
    {
        public void ConfigureServices(IServiceCollection services)
        {
            Console.WriteLine("调用服务注册啦~~");
        }

        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
        {
            Console.WriteLine("调用中间件注册啦");
        }
    }
}

```

<img src={useBaseUrl("img/09.png")} />

### 2.0.8.3 还没看够？

是不是非常强大啊，`Serve.Run()` 虽然简单，但是 100% 支持 `Furion` 和 `.NET` 所有功能。

尽情去体验吧。

## 2.0.9 如何发布

由于是控制台应用程序，我们直接将 `Visual Studio` 切换成 `Release` 编译即可~~。

也可以通过下列命令发布：

```bash showLineNumbers
dotnet publish -c Release
```

更多发布命令说明可查阅微软官方文档 [https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-publish](https://docs.microsoft.com/en-us/dotnet/core/tools/dotnet-publish)

## 2.0.10 应用场景

`Serve.Run()` 更适合以下几种应用场景

- 想要快速上手 `Furion`
- 想要快速创建一个测试项目
- 想要快速创建 `API` 项目
- ......

以上列出的场景并不代表 `Serve.Run()` 只能创建简单的项目，未来它会有更多可能性，现在只是第一步。

对于中大型生产级的项目暂时推荐使用**脚手架**项目架构优先。
